<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <title>Subida de Archivos</title>
    <style>
        :root {
            --primary-color: #2c3e50;
            --accent-color: #27ae60;
            --bg-color: #f4f4f9;
            --text-color: #333;
            --white: #ffffff;
            --blue-color: #3498db;
            --orange-color: #f39c12;
            --red-color: #e74c3c;
        }
        body { font-family: 'Courier New', monospace; background: var(--bg-color); color: var(--text-color); margin: 0; padding: 20px; line-height: 1.6; }
        .container { width: 100%; max-width: 900px; margin: 0 auto; background: var(--white); padding: 40px; border-radius: 12px; box-shadow: 0 10px 25px rgba(0,0,0,0.05); box-sizing: border-box; }
        header { text-align: center; margin-bottom: 30px; border-bottom: 2px solid #eee; padding-bottom: 20px; }
        h1 { font-size: 1.5rem; margin: 0; color: var(--primary-color); text-transform: uppercase; letter-spacing: 1px; }
        .alert { color: var(--red-color); text-align: center; background: #fadbd8; padding: 10px; border-radius: 4px; }
        .success { color: var(--accent-color); text-align: center; background: #e6fff1; padding: 10px; border-radius: 4px; }
        .file-list { margin-top: 30px; border-top: 2px dashed #ddd; padding-top: 20px; }
        .file-item { display: flex; justify-content: space-between; align-items: center; padding: 10px; border-bottom: 1px solid #eee; }
        .file-item:last-child { border-bottom: none; }
        .file-name-info { flex-grow: 1; }
        .file-actions a { color: var(--red-color); text-decoration: none; margin-left: 15px; font-size: 0.9em;}
        input[type="file"], button { padding: 15px; margin: 10px 0; box-sizing: border-box; border: 1px solid #ddd; border-radius: 6px; font-family: inherit; font-size: 1rem; width: 100%; }
        button { background: var(--orange-color); color: var(--white); border: none; cursor: pointer; font-weight: bold; transition: background 0.3s; }
        button:hover { background: #d3850e; }
        .back-link { display: inline-block; margin-bottom: 20px; color: var(--blue-color); text-decoration: none; font-weight: bold;}
    </style>
</head>
<body>

<div class="container">
    <header>
        <h1>Centro de Archivos</h1>
        <p>Archivos para el Proyecto ID: <?= htmlspecialchars($id_bloque) ?></p>
    </header>

    <a href="index.php" class="back-link">‚Üê Volver al Panel de Control</a>
    
    <?php if (!empty($mensaje)): ?>
        <p class="<?= (strpos($mensaje, 'Error') !== false) ? 'alert' : 'success' ?>"><?= htmlspecialchars($mensaje) ?></p>
    <?php endif; ?>

    <div style="background: #fff8e8; padding: 20px; border-radius: 8px; border: 1px solid var(--orange-color);">
        <h4 style="margin-top:0; color: var(--orange-color);">üì§ Subir Nuevo Archivo (.png, .mp4)</h4>
        
        <form action="index.php?action=process_upload" method="POST" enctype="multipart/form-data">
            <input type="hidden" name="block_id" value="<?= htmlspecialchars($id_bloque) ?>">
            
            <input type="file" name="media_file" accept="image/png, video/mp4" required>
            
            <button type="submit">Subir Archivo</button>
        </form>
    </div>

    <div class="file-list">
        <h4 style="color: var(--primary-color);">üìÇ Archivos Asociados (<?= count($archivos_media) ?>)</h4>
        
        <?php if (empty($archivos_media)): ?>
            <p style="text-align: center; color: #7f8c8d;">No hay archivos multimedia subidos para este proyecto.</p>
        <?php else: ?>
            <?php foreach ($archivos_media as $archivo): ?>
                <div class="file-item">
                    <div class="file-name-info">
                        <strong><?= htmlspecialchars($archivo['nombre_archivo']) ?></strong> 
                        <span style="font-size: 0.8em; color: #7f8c8d;">(<?= htmlspecialchars($archivo['tipo_mime']) ?>)</span>
                        <span style="display: block; font-size: 0.7em; color: #a0a0a0;">
                            Subido: <?= date('Y-m-d H:i', strtotime($archivo['subido_en'])) ?>
                        </span>
                    </div>
                    <div class="file-actions">
                        <a href="<?= htmlspecialchars($archivo['ruta_archivo']) ?>" target="_blank" style="color: var(--blue-color);">[Ver]</a>
                        <a href="index.php?action=delete_media&id=<?= $archivo['id'] ?>&block_id=<?= $id_bloque ?>"
                           onclick="return confirm('¬øSeguro que quieres eliminar este archivo?');">
                           [Eliminar]
                        </a>
                    </div>
                </div>
            <?php endforeach; ?>
        <?php endif; ?>
        
    </div>
</div>

</body>
</html>